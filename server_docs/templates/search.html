{% extends "./base.html" %}
{% block content %}
<style>
    .search-container-sub {
        display: flex;
        padding-bottom: 9px;
        width: 100%;
    }
    .result-button {
        display: block;
        width: 99%;
        margin: 4px;
        border: 4px solid black;
        padding: 2px;
        text-align: left;
    }
</style>
<h1>search</h1>
<div class="search-container-sub">
    <input class="search-bar" id="search-bar">
    <button class="search-button" onclick="search();">
        <img alt="Search button" src="{% static 'server_docs/images/search.webp' %}" class="search-button">
    </button>
</div>
<div id="container"></div>
<script>
    var json = undefined;
    function connect() {
        $(document).ready(function() {
            $('#container').empty();
            $.getJSON('/api/enabled_html', function(data) {
                json = data;
            }).fail(function() {
                $('#container').append($('<h1>404 error</h1>'));
                $('#container').append($('<p><b>API connection timeout.</b></p>'));
                $('#container').append('<button onclick="connect();">reconnect</button>');
            });
        });
    }

    function search() {
        $(document).ready(function() {
            if (json) {
                var container = $('#container').empty();
                var urls = Object.keys(json)
                var docs = Object.values(json);
                var key = document.getElementById('search-bar').value;
                var ruselt = [];
                for (var i = 0; i < docs.length; i++) {
                    var j = 0;
                    if (docs[i].includes(key)) {
                        ruselt[j] = docs[i];
                        j++;
                    }  
                }
                if (ruselt.length == 1) {
                    var word = ' page';
                } else {
                    var word = ' pages';
                }
                // <big><big><b>Found 3 pages</b></big></big>
                container.append($('<big><big><b>Found ' // <big><big><b>Found 
                + ruselt.length // 3
                + word //  pages
                + '</b></big></big>')); // </b></big></big>
                for (var i = 0; i < urls.length; i++) {
                    if (ruselt.includes(docs[i])) {
                        // <a href="/example" title="Example page" | Myserver"><button class="button"><h1>Example page</h1></button></a>
                        container.append($('<a href="' // <a href="
                        + ('/' + urls[i]).replace('.html', '') // /example
                        + '" title="' // " title="
                        + docs[i] // Example page
                        + ' | {{ server_name }}"><button class="result-button"><h1>' //  | Myserver"><button class="result-button"><h1> 
                        + docs[i] // Example page
                        + '</h1></button></a>')); // </h1></button></a>
                    }
                }
            }
        });
    }

    connect()
    $(document).ready(function () {
        var myURL = new URL(window.location.href);
        var key = new URLSearchParams(myURL.search).get('key').replace(/\+/g, ' ');
        if (key) {
            $('#search-bar').attr('value', key);
            search()
        }

        $('.picture').css('padding-bottom', '9px')
    });
</script>
{% endblock content %}
